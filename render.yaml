services:
  - type: web
    name: controlventas-web
    env: python
    plan: free
    buildCommand: "pip install -r requirements.txt"
    # Bind to Render port, limit workers and increase timeout to avoid worker timeouts
    # during DB connection retries. Render sets $PORT automatically.
    # Use 1 worker to reduce memory on free plan and avoid OOM.
    startCommand: "gunicorn ControlVentas.wsgi:application --bind 0.0.0.0:$PORT --workers 1 --timeout 120"
    autoDeploy: true
    healthCheckPath: "/health"
    # Do NOT put secrets here. Set them in the Render dashboard (Environment -> Environment Regions/Variables).
    envVars:
      - key: DJANGO_SETTINGS_MODULE
        value: ControlVentas.settings
        # scope: environment

hooks:
  postdeploy:
    - python manage.py migrate
    - python manage.py collectstatic --noinput

# Notes:
# - On Render, set the DATABASE_URL environment variable (recommended) to:
#   postgres://<user>:<password>@<host>:<port>/<dbname>
# - Alternatively, set individual env vars: user, password, host, port, dbname and PGSSLMODE=require
# - Set SECRET_KEY and any other required secrets via the web dashboard, not in this file.